<div id="mailOutils2">
    <h2 ng-show="vm.modeEdition" class="text-center">Modification du block {{ vm.currentBlock.type }}</h2>
    <div class="btn-group btn-group-justified" role="group" aria-label="Justified button group">
        <a ng-hide="vm.vm.currentBlock.type == 'divider'" href="#list" class="btn btn-default active" role="button" data-toggle="tab">
            Content
        </a>
        <a ng-hide="vm.vm.currentBlock.type == 'divider'" href="#settings" class="btn btn-default" role="button" data-toggle="tab">
            <span ng-show="vm.modeEdition">Style</span>
            <span ng-show="!vm.modeEdition">Design</span>
        </a>
    </div>

    <div class="tab-content" id="mailOutils3">
        <div id="list" role="tabpanel" class="tab-pane scrollable active">
            <br/>
            <div ng-include="vm.modeEdition ? 'editionMode.html' : 'chooseBlock.html'"></div>
        </div>
        <div id="settings" role="tabpanel" class="tab-pane scrollable">
            <br/>
            <style-picker block="vm.vm.currentBlock"></style-picker>
        </div>
    </div>

    <div>
        <button ng-show="vm.modeEdition"  type="button" class="btn btn-default" ng-click="saveAndClose()">Valider et fermer</button>
        <button type="button" ng-click="vm.preview()" class="btn btn-default">
            <span class="glyphicon glyphicon-export"></span>
            Prévisualiser
        </button>
        <button ng-show="!vm.modeEdition" type="button" ng-click="vm.send()" class="btn btn-default">
            <span class="glyphicon glyphicon-send"></span>
            Programmer
        </button>
        <button ng-show="!vm.modeEdition" ng-click="vm.addBlock()" class="btn btn-default btn-lg pull-right">
            <span class="glyphicon glyphicon-plus"></span>
            Ajouter un block
        </button>
    </div>
</div>

<script type="text/ng-template" id="editionMode.html">
    <divider-editor  ng-if="vm.vm.currentBlock.type === 'divider'" block="vm.currentBlock"></divider-editor>
    <text-editor ng-if="vm.currentBlock.type == 'text'" block="vm.currentBlock"></text-editor>
    <image-picker ng-if="vm.currentBlock.type == 'file'"  block="vm.currentBlock"></image-picker>
    <button-editor ng-if="vm.currentBlock.type == 'button'" block="vm.currentBlock"></button-editor>
    <link-editor ng-if="vm.currentBlock.type == 'unsub' || vm.currentBlock.type == 'online'" block="vm.currentBlock"></link-editor>
    <div ng-if="vm.currentBlock.type == 'double' || vm.currentBlock.type == 'footer'">
        <accordion>
            <accordion-group ng-repeat="cell in vm.currentBlock.cells track by $index"
                    ng-switch on="cell.type"
                    heading="Section #{{$index + 1}}">
                <text-editor ng-switch-when="text" block="cell"></text-editor>
                <image-picker ng-switch-when="file" block="cell"></image-picker>
                <block-social-editor ng-switch-when="social" block="cell"></block-social-editor>
            </accordion-group>
        </accordion>
    </div>
</script>
<script type="text/ng-template" id="chooseBlock.html">
    <br/>
    <ul class="settings-panel list-inline">
        <li ng-repeat="block in ::availableBlocks"
            draggable
            data-type="{{ block.type }}"
            class="draggable btn btn-default btn-lg">
              <span>
                <span class="glyphicon glyphicon-{{block.icons[0]}}"></span>
                <span ng-if="block.icons.length > 1" class="glyphicon glyphicon-{{block.icons[1]}}"></span>
              </span>
            <br/>
            <span class="small">{{block.text}}</span>
        </li>
    </ul>
</script>
<script type="text/ng-template" id="modalPreview.html">
    <div class="modal-header">
        <h3 class="modal-title">Prévisualisation du template</h3>
    </div>
    <div class="modal-body" ng-style="style.background" id="preview">
        <table ng-style="style.table" class="emailCompo" id="emailTemplate1">
            <tr ng-repeat="block in preview track by $index"
                ng-class="{'mailFooter': block.type === 'footer', 'mailHr': block.type === 'divider'}"
                ng-style="block.attributes">
                <td ng-class="{'emailImg': block.type === 'file',
                    'mailSocial': block.type === 'social',
                    'mailLogo': block.type === 'text'}"
                    ng-style="block.attributes">
                    <div ng-bind-html="block.content | sanitize"></div>
                </td>
            </tr>
        </table>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" ng-click="exit()">Revenir</button>
    </div>
</script>

